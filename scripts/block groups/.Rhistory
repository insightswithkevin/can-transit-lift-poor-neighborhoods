library(tidycensus)
library(tidyverse)
library(tmap)
library(sf)
library(here)
library(MatchIt)
library(optmatch)
library(cobalt)
library(readr)
library(modelsummary)
library(broom)
library(hrbrthemes)
library(extrafont)
library(ggthemes)
library(ggplot2)
library(ggpubr)
here()
appended_df <- st_read(here("data/block groups/outputs/appended_df.shp"))
appended_df_2013_2017 <- st_read(here("data/block groups/outputs/appended_df_2013_2017.shp"))
appended_df_2017_2022 <- st_read(here("data/block groups/outputs/appended_df_2017_2022.shp"))
appended_df <- appended_df %>%
select(GEOID, NAME, geometry, year, treatment = tretmnt, distance = distanc,
weights, subclass = subclss, medhinc_block = mdhnc_b, medhinc_county = mdhnc_c,
medhinc_ratio_block = mdhnc__, income_quintiles = incm_qn, unemployment_rate = unmply_,
low_inc_hh = lw_nc_h, total_pop = totl_pp, median_age = medin_g, median_rent = mdn_rnt,
distance_centroid_cbd = dstnc__, after_2013 = af_2013)
appended_df_2013_2017 <- appended_df_2013_2017 %>%
select(GEOID, NAME, geometry, year, treatment = tretmnt, distance = distanc,
weights, subclass = subclss, medhinc_block = mdhnc_b, medhinc_county = mdhnc_c,
medhinc_ratio_block = mdhnc__, income_quintiles = incm_qn, unemployment_rate = unmply_,
low_inc_hh = lw_nc_h, total_pop = totl_pp, median_age = medin_g, median_rent = mdn_rnt,
distance_centroid_cbd = dstnc__, after_2013 = af_2013)
appended_df_2017_2022 <- appended_df_2017_2022 %>%
select(GEOID, NAME, geometry, year, treatment = tretmnt, distance = distanc,
weights, subclass = subclss, medhinc_block = mdhnc_b, medhinc_county = mdhnc_c,
medhinc_ratio_block = mdhnc__, income_quintiles = incm_qn, unemployment_rate = unmply_,
low_inc_hh = lw_nc_h, total_pop = totl_pp, median_age = medin_g, median_rent = mdn_rnt,
distance_centroid_cbd = dstnc__, after_2017 = af_2017)
appended_df <- appended_df %>%
mutate(log_medhinc_block = log(medhinc_block))
appended_df_2013_2017 <- appended_df_2013_2017 %>%
mutate(log_medhinc_block = log(medhinc_block))
appended_df_2017_2022 <- appended_df_2017_2022 %>%
mutate(log_medhinc_block = log(medhinc_block))
appended_df$year <- as.factor(appended_df$year)
appended_df$treatment <- as.factor(appended_df$treatment)
appended_df_2013_2017$year <- as.factor(appended_df_2013_2017$year)
appended_df_2013_2017$treatment <- as.factor(appended_df_2013_2017$treatment)
appended_df_2017_2022$year <- as.factor(appended_df_2017_2022$year)
appended_df_2017_2022$treatment <- as.factor(appended_df_2017_2022$treatment)
diffs_2013_2017 <- appended_df %>%
group_by(after_2013, treatment) %>%
summarize(mean_log_medhinc = mean(log_medhinc_block))
before_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 1) %>%
pull(mean_log_medhinc)
before_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 0) %>%
pull(mean_log_medhinc)
after_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 1) %>%
pull(mean_log_medhinc)
after_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 0) %>%
pull(mean_log_medhinc)
diff_treatment_before_after_2013_2017 <- after_treatment_2013_2017 - before_treatment_2013_2017
diff_control_before_after_2013_2017 <- after_control_2013_2017 - before_control_2013_2017
diff_diff_2013_2017 <- diff_treatment_before_after_2013_2017 - diff_control_before_after_2013_2017
treatment_plot_medhinc_2013_2017 <- ggplot(data = diffs_2013_2017, aes(x = after_2013, y = mean_log_medhinc, color = factor(treatment))) +
geom_point(alpha = 0.7, size = 2) +
geom_line(aes(group = treatment), size = 1) +
geom_segment(aes(x = 0, xend = 1, y = before_treatment_2013_2017, yend = after_treatment_2013_2017 - diff_diff_2013_2017, linetype = "Dotted Line (Pre-Treatment)"),
size = 0.8, color = "black") +
geom_segment(aes(x = 1, xend = 1, y = after_treatment_2013_2017 - diff_diff_2013_2017, yend = after_treatment_2013_2017, linetype = "Dashed Line (Treatment Effect)"),
size = 0.8, color = "black") +
labs(
title = "Log. median household income before and after E-Line expansion (2013-2017)",
x = "Before and after treatment",
y = "Median household income",
color = "Group",
linetype = "Effect"
) +
scale_color_manual(
values = c("blue", "red"),
labels = c("Control units", "Treated units")
) +
scale_x_continuous(limits = c(0, 1), breaks = c(0, 1)) +
theme_fivethirtyeight() +
theme(
axis.title = element_text(size = 12),
text = element_text(family = "Rubik"),
legend.position = "top"
)
treatment_plot_medhinc_2013_2017
diffs_2013_2017 <- appended_df %>%
group_by(after_2013, treatment) %>%
summarize(mean_low_inc = mean(low_inc_hh))
before_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 1) %>%
pull(mean_low_inc)
before_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 0) %>%
pull(mean_low_inc)
after_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 1) %>%
pull(mean_low_inc)
after_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 0) %>%
pull(mean_low_inc)
diff_treatment_before_after_2013_2017 <- after_treatment_2013_2017 - before_treatment_2013_2017
diff_control_before_after_2013_2017 <- after_control_2013_2017 - before_control_2013_2017
diff_diff_2013_2017 <- diff_treatment_before_after_2013_2017 - diff_control_before_after_2013_2017
treatment_plot_low_inc_2013_2017 <- ggplot(data = diffs_2013_2017, aes(x = after_2013, y = mean_low_inc, color = factor(treatment))) +
geom_point(alpha = 0.7, size = 2) +
geom_line(aes(group = treatment), size = 1) +
geom_segment(aes(x = 0, xend = 1, y = before_treatment_2013_2017, yend = after_treatment_2013_2017 - diff_diff_2013_2017, linetype = "Dotted Line (Pre-Treatment)"),
size = 0.8, color = "black") +
geom_segment(aes(x = 1, xend = 1, y = after_treatment_2013_2017 - diff_diff_2013_2017, yend = after_treatment_2013_2017, linetype = "Dashed Line (Treatment Effect)"),
size = 0.8, color = "black") +
labs(
title = "Share of low-income households before and after E-Line expansion (2013-2017)",
x = "Before and after treatment",
y = "Share of low-income households",
color = "Group",
linetype = "Effect"
) +
scale_color_manual(
values = c("blue", "red"),
labels = c("Control units", "Treated units")
) +
scale_x_continuous(limits = c(0, 1), breaks = c(0, 1)) +
theme_fivethirtyeight() +
theme(
axis.title = element_text(size = 12),
text = element_text(family = "Rubik"),
legend.position = "top"
)
treatment_plot_low_inc_2013_2017
diffs_2013_2017 <- appended_df %>%
group_by(after_2013, treatment) %>%
summarize(mean_log_medhinc = mean(log_medhinc_block))
before_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 1) %>%
pull(mean_log_medhinc)
before_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 0) %>%
pull(mean_log_medhinc)
after_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 1) %>%
pull(mean_log_medhinc)
after_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 0) %>%
pull(mean_log_medhinc)
diff_treatment_before_after_2013_2017 <- after_treatment_2013_2017 - before_treatment_2013_2017
diff_control_before_after_2013_2017 <- after_control_2013_2017 - before_control_2013_2017
diff_diff_2013_2017 <- diff_treatment_before_after_2013_2017 - diff_control_before_after_2013_2017
treatment_plot_medhinc_2013_2017 <- ggplot(data = diffs_2013_2017, aes(x = after_2013, y = mean_log_medhinc, color = factor(treatment))) +
geom_point(alpha = 0.7, size = 2) +
geom_line(aes(group = treatment), size = 1) +
geom_segment(aes(x = 0, xend = 1, y = before_treatment_2013_2017, yend = after_treatment_2013_2017 - diff_diff_2013_2017, linetype = "Dotted Line (Pre-Treatment)"),
size = 0.8, color = "black") +
geom_segment(aes(x = 1, xend = 1, y = after_treatment_2013_2017 - diff_diff_2013_2017, yend = after_treatment_2013_2017, linetype = "Dashed Line (Treatment Effect)"),
size = 0.8, color = "black") +
labs(
title = "Log. median household income before and after E-Line expansion (2013-2017)",
x = "Before and after treatment",
y = "Median household income",
color = "Group",
linetype = "Effect"
) +
scale_color_manual(
values = c("blue", "red"),
labels = c("Control units", "Treated units")
) +
scale_x_continuous(limits = c(0, 1), breaks = c(0, 1)) +
theme_fivethirtyeight() +
theme(
axis.title = element_text(size = 12),
text = element_text(family = "Rubik"),
legend.position = "top"
)
treatment_plot_medhinc_2013_2017
diffs_2013_2017 <- appended_df %>%
group_by(after_2013, treatment) %>%
summarize(mean_unemployment = mean(unemployment_rate))
before_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 1) %>%
pull(mean_unemployment)
before_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 0, treatment == 0) %>%
pull(mean_unemployment)
after_treatment_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 1) %>%
pull(mean_unemployment)
after_control_2013_2017 <- diffs_2013_2017 %>%
filter(after_2013 == 1, treatment == 0) %>%
pull(mean_unemployment)
diff_treatment_before_after_2013_2017 <- after_treatment_2013_2017 - before_treatment_2013_2017
diff_control_before_after_2013_2017 <- after_control_2013_2017 - before_control_2013_2017
diff_diff_2013_2017 <- diff_treatment_before_after_2013_2017 - diff_control_before_after_2013_2017
treatment_plot_unemployment_2013_2017 <- ggplot(data = diffs_2013_2017, aes(x = after_2013, y = mean_unemployment, color = factor(treatment))) +
geom_point(alpha = 0.7, size = 2) +
geom_line(aes(group = treatment), size = 1) +
geom_segment(aes(x = 0, xend = 1, y = before_treatment_2013_2017, yend = after_treatment_2013_2017 - diff_diff_2013_2017, linetype = "Dotted Line (Pre-Treatment)"),
size = 0.8, color = "black") +
geom_segment(aes(x = 1, xend = 1, y = after_treatment_2013_2017 - diff_diff_2013_2017, yend = after_treatment_2013_2017, linetype = "Dashed Line (Treatment Effect)"),
size = 0.8, color = "black") +
labs(
title = "Unemployment rate before and after E-Line expansion (2013-2017)",
x = "Before and after treatment",
y = "Unemployment rate",
color = "Group",
linetype = "Effect"
) +
scale_color_manual(
values = c("blue", "red"),
labels = c("Control units", "Treated units")
) +
scale_x_continuous(limits = c(0, 1), breaks = c(0, 1)) +
theme_fivethirtyeight() +
theme(
axis.title = element_text(size = 12),
text = element_text(family = "Rubik"),
legend.position = "top"
)
treatment_plot_unemployment_2013_2017
